self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.Notification.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[341],{13801:function(e,t,n){"use strict";n.r(t);var r,i=n(1169);function c(){return r||(r=new i.a),r}var a,o,s,u=n(0),d=n(760),l=function(){return a||(a=Object(d.a)()),a},f=function(){void 0===o&&(o=new Promise(function(e){s=e}))},b=function(){return f(),o},p=function(){f(),s()};var h,v={ChannelData:"ChannelData",SubscriptionAdded:"SubscriptionAdded",SubscriptionRemoved:"SubscriptionRemoved",SubscriptionUpdated:"SubscriptionUpdated",NotificationData:"NotificationData",TraceWarn:"TraceWarn",TraceError:"TraceError"};function m(e){c().emit(v.TraceWarn,e)}var g=!1;function w(){return g||j(),Object.keys(h).map(function(e){return h[e].refs[0].subscription})}function _(e){return g||j(),k(e)?h[e].refs:[]}function y(e){return h[e]}function k(e){return e in h}function j(){h={},g=!0}function R(e){try{e()}catch(e){t=e,c().emit(v.TraceError,t)}var t}var I="Reload";function O(e,t){var n,r;c().emit(v.NotificationData,e);var i=_(e.id).map(function(e){return e.callback}),a=function(t){R(function(){t(e)})};try{for(var o=Object(u.__values)(i),s=o.next();!s.done;s=o.next()){a(s.value)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}function T(e){return{id:e,EventType:I}}function S(){var e,t,n=w();try{for(var r=Object(u.__values)(n),i=r.next();!i.done;i=r.next()){O(T(i.value.subscriptionId))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}var x=[],E=!1,C=function(){return x},U=function(e){return x.push(e)},D=function(){return x=[]},H=function(e){return E=e},M=function(){return E},A=n(9606),N=n.n(A),P=n(9608),q=n.n(P),W=n(239),z=n(105),F=3,G=8,J=3e5,Q=500;function X(e){return Object(u.__awaiter)(this,void 0,void 0,function(){var t,n=this;return Object(u.__generator)(this,function(r){switch(r.label){case 0:return 0!==(t=y(e.subscriptionId)).pendingRetryHandle&&(window.clearTimeout(t.pendingRetryHandle),t.pendingRetryHandle=0),t.status=2,ee(e,t),Object(z.e)("fwk-batchSubscriptions")?(U(e),M()||(window.setTimeout(function(){return Object(u.__awaiter)(n,void 0,void 0,function(){var e;return Object(u.__generator)(this,function(t){switch(t.label){case 0:return e=C(),D(),H(!1),[4,Y(e)];case 1:return t.sent(),[2]}})})},Q),H(!0)),[3,3]):[3,1];case 1:return[4,Y([e])];case 2:r.sent(),r.label=3;case 3:return[2]}})})}function Y(e){return Object(u.__awaiter)(this,void 0,void 0,function(){var t,n,r=this;return Object(u.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,5]),[4,N()({request:{Header:Object(W.getJsonRequestHeader)()},subscriptionData:e.map(function(e){return{SubscriptionId:e.subscriptionId,Parameters:e.subscriptionParameters}})})];case 1:return t=i.sent(),[4,Z(e,function(e,n){return Object(u.__awaiter)(r,void 0,void 0,function(){var r;return Object(u.__generator)(this,function(i){switch(i.label){case 0:return 0===(r=t.filter(function(e){return e.SubscriptionId===n.subscriptionId})).length?[3,2]:[4,K(r[0],n,e)];case 1:return i.sent(),[3,4];case 2:return[4,L(n,e,new Error(n.subscriptionId+" not in subscription responses"))];case 3:i.sent(),i.label=4;case 4:return[2]}})})})];case 2:return i.sent(),[3,5];case 3:return n=i.sent(),[4,Z(e,function(e,t){return Object(u.__awaiter)(r,void 0,void 0,function(){return Object(u.__generator)(this,function(r){switch(r.label){case 0:return[4,L(t,e,n)];case 1:return r.sent(),[2]}})})})];case 4:return i.sent(),[3,5];case 5:return[2]}})})}function B(e){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,q()({subscriptionData:[{SubscriptionId:e.subscriptionId,Parameters:e.subscriptionParameters}]})];case 1:return t.sent(),[3,3];case 2:return m("Subscription unsubscribe failed: "+t.sent().message),[3,3];case 3:return[2]}})})}function K(e,t,n){return Object(u.__awaiter)(this,void 0,void 0,function(){var r,i,c;return Object(u.__generator)(this,function(a){switch(a.label){case 0:return e.SuccessfullyCreated?[3,2]:[4,V(t,n,e.ErrorInfo)];case 1:return a.sent(),[3,3];case 2:if(n.retries>0)for(r=_(t.subscriptionId),i=0;i<r.length;i++)(c=r[i]).subscription.onReconnected&&R(c.subscription.onReconnected);n.retries=0,n.pendingRetryHandle=0,n.status=3,ee(t,n,""),a.label=3;case 3:return[2]}})})}function L(e,t,n){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(r){switch(r.label){case 0:return[4,V(e,t,n.message)];case 1:return r.sent(),[2]}})})}function V(e,t,n){return Object(u.__awaiter)(this,void 0,void 0,function(){var r,i,c;return Object(u.__generator)(this,function(a){switch(a.label){case 0:if(function(e){var t,n,r=T(e),i=_(e),c=function(e){!0!==e.subscription.noSubscriptionFailureReload&&R(function(){e.callback(r)})};try{for(var a=Object(u.__values)(i),o=a.next();!o.done;o=a.next())c(o.value)}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}(e.subscriptionId),0===t.retries)for(r=_(e.subscriptionId),i=function(e){var t=r[e];t.subscription.onDisconnected&&R(function(){t.subscription.onDisconnected(n)})},c=0;c<r.length;c++)i(c);return t.retries+=1,t.status=1,t.retries<F?[4,X(e)]:[3,2];case 1:return a.sent(),[3,3];case 2:t.retries<G&&(t.pendingRetryHandle=window.setTimeout(function(){t.pendingRetryHandle=0,X(e)},J)),a.label=3;case 3:return ee(e,t,n),[2]}})})}function Z(e,t){return Object(u.__awaiter)(this,void 0,void 0,function(){var n=this;return Object(u.__generator)(this,function(r){switch(r.label){case 0:return[4,Promise.all(e.map(function(e){return Object(u.__awaiter)(n,void 0,void 0,function(){var n;return Object(u.__generator)(this,function(r){switch(r.label){case 0:return(n=y(e.subscriptionId))?[4,t(n,e)]:[2];case 1:return r.sent(),[2]}})})}))];case 1:return r.sent(),[2]}})})}function ee(e,t,n){c().emit(v.SubscriptionUpdated,e,t,n)}var te,ne,re,ie,ce=n(230),ae="pg",oe="ReloadAllNotification",se=-1,ue=6e4;function de(){te.qs={UA:"0",cid:re.channelId,"X-OWA-CANARY":Object(ce.getOwaCanaryCookie)()}}function le(){re.giveUpReconnecting=!1,re.reconnectScheduled=!1,te.start(ne)}function fe(e){var t,n,r=e;try{for(var i=Object(u.__values)(r),c=i.next();!c.done;c=i.next()){var a=c.value;a.id===ae?be(a):a.id===oe?(S(),ye("reload all"),re.mark++):(O(a),re.mark++)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}function be(e){switch("update"!==e.data&&ye(e.data),e.data){case"alive1":!function(e){2===re.state&&ye("alive1 when channel was already ready");ye("channel ids: local "+re.channelId+" server "+e.cid),ye("client mark: "+re.mark+", server mark: "+e.mark),re.channelId=e.cid,re.state=2,de(),pe(e),re.mark=0,p()}(e);break;case"reinitSubscriptions":Promise.all(w().map(function(e){X(e)})),ye("reinit subscriptions");break;case"validateSubscriptions":ye("validate subscriptions:"+function(e){var t=[];if(null!=e){for(var n={},r=0;r<e.length;++r)null!=e[r]&&(n[e[r]]=!0);for(var i=w(),c=0;c<i.length;++c)3!=y(i[c].subscriptionId).status||n[i[c].subscriptionId]||(t.push(i[c].subscriptionId),X(i[c]))}return t}(e.subscriptionIds).join("|"));break;case"update":pe(e);break;case"backendConnectionDropped":!function(){ve();var e=Math.floor(Math.random()*ue);re.reconnectTimeout=ie.backoffMaximum,we(e)}(),ye("backend connection dropped");break;case"diagnostic":ye("diagnostic: "+e.message)}}function pe(e){e.mark!==re.mark&&(ye("mark mismatch local: "+re.mark+", server: "+e.mark),S(),re.mark=e.mark)}function he(e){e.context&&(401===e.context.status||440===e.context.status?(ye("session timed out"),re.giveUpReconnecting=!0,ie.handleSessionTimeout&&ie.handleSessionTimeout()):449===e.context.status&&(ye("Canary cookie expiration"),de()))}function ve(){ye("connection stopped"),re.state=3,re.giveUpReconnecting=!0,te.stop()}function me(){1==re.state?re.state=0:2!=re.state&&4!=re.state||(re.state=3),!0!==re.giveUpReconnecting&&we()}function ge(e){switch(e.newState){case 1:0===re.state?(re.state=1,ye("channel initialized")):3===re.state&&(re.state=4,ye("channel reconnecting")),re.reconnectTimeout=Math.abs(ie.minimumReconnectInterval),re.checkReadyTimer=window.setTimeout(_e,ie.readyCheckTimeout);break;case 4:case 2:1===re.state?(re.state=0,ye("channel uninitialized")):2===re.state&&(re.state=4,ye("channel reconnecting")),re.checkReadyTimer!==se&&(window.clearTimeout(re.checkReadyTimer),re.checkReadyTimer=se)}}function we(e){var t=Math.abs(re.reconnectTimeout);void 0!==e&&(t+=e),ye("retrying connection with backoff "+t),window.setTimeout(le,t),re.reconnectTimeout=Math.min(2*Math.abs(re.reconnectTimeout),Math.abs(ie.backoffMaximum)),re.reconnectScheduled=!0}function _e(){2!==re.state&&(ye("ready check timer expired"),ve(),we())}function ye(e){c().emit(v.ChannelData,e)}function ke(e,t,n,r){te=e,ne=t,ie=r,(re=n).channelId=l(),te.received(fe),te.error(he),te.disconnected(me),te.stateChanged(ge),de();var i=te.stop.bind(te);te.stop=function(e,t){i(!0,t)},$.signalR.ajaxDefaults.timeout=6e4,$.signalR.transports.serverSentEvents.timeOut=6e4,le()}var je=n(9609);function Re(e){window.$=je,window.jQuery=je,n(9610);var t={state:0,channelId:null,mark:0,reconnectTimeout:e.minimumReconnectInterval,reconnectScheduled:!1,giveUpReconnecting:!1,checkReadyTimer:-1};if(Object(z.e)("fwk-patchSignalRGetUrl")){var r=je.signalR.transports._logic.getUrl;je.signalR.transports._logic.getUrl=function(e,t,n,i,c){return e.appRelativeUrl=e.url,r(e,t,n,i,c)}}ke(je.connection(e.channelEndpoint),{transport:[je.signalR.transports.serverSentEvents.name,je.signalR.transports.foreverFrame.name],pingInterval:e.pingInterval},t,e)}function Ie(e,t){!function(e,t){g||j(),k(e.subscriptionId)||(h[e.subscriptionId]={refs:[],status:0,retries:0,pendingRetryHandle:0}),h[e.subscriptionId].refs.push({subscription:e,callback:t})}(e,t),function(e){Object(u.__awaiter)(this,void 0,void 0,function(){var t;return Object(u.__generator)(this,function(n){switch(n.label){case 0:return e.requiresExplicitSubscribe?0!==(t=y(e.subscriptionId)).status?[3,2]:(c().emit(v.SubscriptionAdded,e),[4,X(e)]):[2];case 1:return n.sent(),[3,3];case 2:ee(e,t),n.label=3;case 3:return[2]}})})}(e)}function Oe(e,t){!function(e,t){if(k(e.subscriptionId)){for(var n=h[e.subscriptionId].refs,r=0;r<n.length;r++)if(n[r].callback===t){n.splice(r,1);break}0===n.length&&(0!==h[e.subscriptionId].pendingRetryHandle&&window.clearTimeout(h[e.subscriptionId].pendingRetryHandle),delete h[e.subscriptionId])}else m("Tried to remove "+e.subscriptionId+" from the subscription tracker when it didn't exist")}(e,t),function(e){Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(t){switch(t.label){case 0:return e.requiresExplicitSubscribe?k(e.subscriptionId)?[3,2]:(c().emit(v.SubscriptionRemoved,e),[4,B(e)]):[2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}(e)}n.d(t,"EventEmitter",function(){return Te}),n.d(t,"subscribe",function(){return Ie}),n.d(t,"unsubscribe",function(){return Oe}),n.d(t,"getChannelId",function(){return l}),n.d(t,"getChannelReady",function(){return b}),n.d(t,"initializeNotificationManager",function(){return Re}),n.d(t,"getNotificationEmitter",function(){return c}),n.d(t,"NotificationEventType",function(){return v});var Te=typeof i.a}}]);
//# sourceMappingURL=owa.Notification.js.map
self.scriptsLoaded['owa.Notification.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.Notification.js'] = (new Date()).getTime();