self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.27.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[27],{2373:function(e,r,t){"use strict";var n,a=t(2),o=Object(a.createStore)("cacheLoaderStore",{loadedCalendarAccounts:[]});!function(e){e[e.Outlook=0]="Outlook",e[e.OutlookGroup=1]="OutlookGroup"}(n||(n={}));var d=t(218),i=t(175);function c(e,r){switch(e){case n.Outlook:return(r||Object(i.e)().primarySmtpAddress)+e.toString();case n.OutlookGroup:return e.toString();default:return Object(d.a)(e)}}function l(e,r){var t=c(e,r);return o().loadedCalendarAccounts.some(function(e){return e===t})}var s=Object(a.action)("addToLoadedCalendarAccounts",function(e){return{calendarAccountData:e}});Object(a.mutator)(s,function(e){o().loadedCalendarAccounts.push(e.calendarAccountData)});var u=t(0),b=t(25),f=t(2501),p=Object(a.action)("calendarCacheInitializedForAccount",function(e,r){return{calendarEndpointType:e,userId:r}}),O=t(3941),I={};function m(e,r){if(l(e,r))return Promise.resolve();var t=c(e,r),a=I[t];if(a)return a.requestPromise;var o=function(e,r){return Object(u.__awaiter)(this,void 0,void 0,function(){var t;return Object(u.__generator)(this,function(a){switch(a.label){case 0:switch(e){case n.Outlook:return[3,1];case n.OutlookGroup:return[3,5]}return[3,7];case 1:return a.trys.push([1,3,,4]),r=r||Object(i.e)().primarySmtpAddress,[4,Object(f.d)(r)];case 2:return a.sent(),[3,4];case 3:return t=a.sent(),b.d.error("initializeCalendarsCacheForAccount: failed to initialize calendar cache: "+t),[3,4];case 4:return[3,8];case 5:return[4,Object(O.b)()];case 6:return a.sent(),[3,8];case 7:Object(d.a)(e),a.label=8;case 8:return[2]}})})}(e,r);return I[t]={requestPromise:o},o.then(function(){s(t),p(e,r)})}t.d(r,"d",function(){return l}),t.d(r,"c",function(){return m}),t.d(r,"a",function(){return n}),t.d(r,"b",function(){return p})},2501:function(e,r,t){"use strict";var n=t(0),a=t(260),o=t(175),d=t(60),i=t(397),c=t(25);function l(e,r,t){var l,s={},u={},b={},f={},p={},O=t?[t]:[Object(d.a)().SessionSettings.LogonEmailAddress],I=Object(o.e)(t);return e.forEach(function(e){p[e.ItemId.Id]=e.ItemId.ChangeKey;var t=Object(n.__assign)(Object(n.__assign)({},e),{id:{id:e.GroupId,mailboxInfo:I}}),o=Object(a.q)(I.primarySmtpAddress,e.GroupId);f[o]=t,e.Calendars.forEach(function(e){if(function(e,r){if(7==e.CalendarFolderType)return!1;if(Object(i.c)(e)){var t=e;if(t.IsOwnerEmailAddressInvalid)return c.d.info("[getCalendarsService] Ommitting shared calendar with IsOwnerEmailAddressInvalid flag on, OwnerEmailAddress: {1}: "+t.OwnerEmailAddress),!1;var n=t.IsGeneralScheduleCalendar?t.OwnerEmailAddress:t.SharedFolderId?t.SharedFolderId.Id:null;if(!n)return c.d.info("[getCalendarsService] Ommitting linked calendar with null SharedFolderId, Id: {1}: "+e.ItemId.Id),!1;if(r.includes(n))return c.d.info("[getCalendarsService] Ommitting duplicate shared calendar from Calendar folder list. DuplicateKey: {1}: "+n),!1;if(r.push(n),t.OwnerEmailAddress=t.OwnerEmailAddress.toLowerCase(),t.IsGroupMailboxCalendar)return!1}return!0}(e,O)){var t=e.ItemId.Id,o=Object(a.f)(e).Id,d=Object(n.__assign)(Object(n.__assign)({},e),{id:{id:t,mailboxInfo:I}});if(1==e.CalendarFolderType){var u=r&&r.filter(function(e){return e.FolderId.Id===o})[0];l={id:{id:t,mailboxInfo:I},calculatedFolderId:o,displayName:u?u.DisplayName:e.CalendarName,colorScheme:null},d.CalendarName=l.displayName}!s[t]&&(s[t]=d),!b[o]&&(b[o]={id:e.ItemId.Id,mailboxInfo:I}),!p[t]&&(p[t]=e.ItemId.ChangeKey)}})}),r.forEach(function(e){var r=b[e.FolderId.Id];r&&(u[r.id]=e)}),{defaultCalendar:l,calendarEntryMapping:s,calendarFolderMapping:u,folderIdMapping:b,calendarGroupMapping:f,calendarIdToChangeKeyMapping:p}}var s=t(2881),u=t.n(s),b=t(239),f=t(3052),p=t(277);function O(e){return Object(n.__awaiter)(this,void 0,void 0,function(){var r,t;return Object(n.__generator)(this,function(n){switch(n.label){case 0:return r=null,e&&!Object(o.h)(e)||(r=Object(f.a)()),r?[3,3]:[4,Object(p.e)(Object(o.e)(e))];case 1:return t=n.sent(),[4,u()({Header:Object(b.getJsonRequestHeader)()},t)];case 2:r=n.sent(),n.label=3;case 3:return[2,r]}})})}var I=t(363),m=t.n(I),h=t(3302),j=t.n(h);function v(e,r){return Object(n.__awaiter)(this,void 0,void 0,function(){var t,o,d,i;return Object(n.__generator)(this,function(n){switch(n.label){case 0:return t=new Headers,Object(p.g)(r,t),o={headers:t},d=Object(a.m)(e.Id),i=d&&(d.IsGeneralScheduleCalendar||d.IsGroupMailboxCalendar)?m()({Id:"calendar",Mailbox:{EmailAddress:r}}):5==d.CalendarFolderType?d.SharedFolderId:e,[4,j()({request:{FolderId:i}},o)];case 1:return[2,n.sent()]}})})}var g=t(774),C=t.n(g),y=t(228);function w(e){return Object(n.__awaiter)(this,void 0,void 0,function(){var r,t,i,c,l,s,u;return Object(n.__generator)(this,function(n){switch(n.label){case 0:if(!(r=Object(a.k)(e)))throw new Error("Unable to get calendar entry for calendar "+e);t=Object(a.v)(e),i=Object(a.g)(e),c=Object(a.s)(t),l=c?c.mailboxInfo:Object(o.e)(),s=5==r.CalendarFolderType&&Object(d.a)().SessionSettings.DefaultPublicFolderMailbox?Object(d.a)().SessionSettings.DefaultPublicFolderMailbox:function(e,r){return e||(r?r.primarySmtpAddress:null)}(r.OwnerEmailAddress,l),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,v(C()({Id:i}),s)];case 2:return u=n.sent(),[3,4];case 3:return n.sent(),Object(y.o)("getCalendarFolderConfigurationServiceFailed"),Object(a.F)(r),[2];case 4:if(!u)throw new Error("Unable to get folder for calendar "+e);return Object(a.F)(r),5==r.CalendarFolderType?function(e,r,t){var n=e.CalendarFolder;if(n){r.CalendarFolderId||(r.CalendarFolderId=e.CalendarFolder.FolderId);var d=n.ReplicaList[0];Object(a.b)(r,n,{type:0,deprecatedMailboxId:d,primarySmtpAddress:d,routingKey:Object(o.c)()+d,requestOptions:Object(p.a)(d,t),returnModernConversationItems:t.returnModernConversationItems})}}(u,r,l):function(e,r,t,n){var o=e.CalendarFolder;o&&o.EffectiveRights&&o.EffectiveRights.Read&&(e.MasterList&&(r.RemoteCategories=e.MasterList),(n==r.OwnerEmailAddress||r.ItemId&&n==r.ItemId.Id)&&(Object(a.d)(n,{id:{id:r.ItemId.Id,mailboxInfo:t},calculatedFolderId:o.FolderId.Id}),Object(a.H)(n),Object(a.b)(r,o,t)))}(u,r,l,e),[2]}})})}function _(e){return Object(n.__awaiter)(this,void 0,void 0,function(){var r,t;return Object(n.__generator)(this,function(n){switch(n.label){case 0:return[4,O(e)];case 1:return null!==(r=n.sent())&&r.WasSuccessful?(t=l(r.CalendarGroups,r.CalendarFolders,e),Object(a.z)(t.defaultCalendar,t.calendarEntryMapping,t.calendarFolderMapping,t.calendarGroupMapping,t.folderIdMapping,t.calendarIdToChangeKeyMapping)):c.d.error("[getCalendarFoldersFromServer] Failed to load calendars from server"),[2]}})})}t.d(r,"a",function(){return l}),t.d(r,"c",function(){return O}),t.d(r,"b",function(){return w}),t.d(r,"d",function(){return _})},3941:function(e,r,t){"use strict";var n=t(0),a=t(43),o=t(4276),d=t(4),i=t(1555),c=t.n(i),l=t(1556),s=t.n(l),u=t(239),b="Groups",f=t(175),p=t(397);function O(){return Object(n.__awaiter)(this,void 0,void 0,function(){var e,r;return Object(n.__generator)(this,function(t){switch(t.label){case 0:return 4,(e=[]).push({FilterType:1,SortType:4,SortDirection:"Descending"}),e.push({FilterType:2,SortType:4,SortDirection:"Descending"}),(r=Object(u.getJsonRequestHeader)()).RequestServerVersion="V2018_01_08",[4,c()({Header:r,Body:s()({RequestedGroupsSets:e})})];case 1:return[2,t.sent()]}})})}var I=Object(a.action)("getGroupCalendarsService")(function(){return Object(n.__awaiter)(this,void 0,void 0,function(){var e;return Object(n.__generator)(this,function(r){switch(r.label){case 0:return[4,O()];case 1:return null!=(e=r.sent())&&e.Body.GroupsSets&&e.Body.GroupsSets.length>0?[2,m(e.Body.GroupsSets)]:[2,null]}})})});function m(e){var r=[],t=[];if(e.forEach(function(e){e.Groups.forEach(function(e){var n=e.SmtpAddress.toLowerCase(),a={type:f.a.GroupMailbox,deprecatedMailboxId:n,primarySmtpAddress:n,routingKey:Object(f.c)()+n,returnModernConversationItems:!1,requestOptions:null},o={__type:p.a,CalendarColor:-1,CalendarName:e.DisplayName,OwnerEmailAddress:n,OwnerName:e.DisplayName,IsGroupMailboxCalendar:!0,IsGeneralScheduleCalendar:!0,ItemId:{Id:n},ParentGroupId:b},d={DistinguishedFolderId:n,DisplayName:e.DisplayName};r.push({entry:o,folder:d,mailboxInfo:a});var i={id:{id:n,mailboxInfo:a},calculatedFolderId:n,displayName:e.DisplayName,colorScheme:null};t.push(i)})}),t.length>0){var n=Object(f.e)(),a={type:f.a.GroupMailbox,deprecatedMailboxId:n.deprecatedMailboxId,primarySmtpAddress:n.primarySmtpAddress,routingKey:Object(f.b)(),returnModernConversationItems:!1,requestOptions:null},i={id:{id:b,mailboxInfo:a},GroupId:b,ItemId:{Id:b},GroupName:Object(d.a)(o.a),GroupType:3};return{groupCalendars:r,calendarGroup:i,calendars:t}}return null}var h=t(260),j=Object(a.action)("getGroupCalendars")(function(){return Object(n.__awaiter)(this,void 0,void 0,function(){var e;return Object(n.__generator)(this,function(r){switch(r.label){case 0:return[4,I()];case 1:return null!=(e=r.sent())&&null!=e.groupCalendars?(e.groupCalendars.forEach(function(e){Object(h.b)(e.entry,e.folder,e.mailboxInfo)}),Object(h.a)(e.calendarGroup),[2,{group:e.calendarGroup,calendars:e.calendars}]):[2,null]}})})}),v=t(105),g=t(228),C=t(60),y=Object(a.action)("initializeGroupCalendars")(function(e){return Object(n.__awaiter)(this,void 0,void 0,function(){var r,t,a,o,d,i;return Object(n.__generator)(this,function(n){switch(n.label){case 0:r=new g.a("initializeGroupCalendars"),t=Object(C.a)().GroupsEnabled,a=Object(v.e)("cal-groupsCalendar"),o=!Object(h.r)().some(function(e){return e.GroupId===b}),d=t&&a&&(e||o),r.addCustomData({issueServiceCall:d,GroupsEnabled:t,featureEnabled:a,refresh:e,initialLoad:o}),n.label=1;case 1:return n.trys.push([1,4,,5]),d?[4,j()]:[3,3];case 2:n.sent(),n.label=3;case 3:return r.end(),[3,5];case 4:throw i=n.sent(),r.endWithError("ServerError",Error(i)),i;case 5:return[2]}})})}),w=t(2),_=t(25),S=t(391),F=null;Object(w.orchestrator)(h.y,function(e){var r=e.payload,t=r.id,n=r.EventType,a=r.Group.SmtpAddress;_.d.info(t+": "+n+", "+a),F||(F=Object(S.a)(y.bind(null,!0),2e3)),F()}),t.d(r,"b",function(){return y}),t.d(r,"a",function(){return b})},4276:function(e){e.exports={a:"Hbb"}}}]);
//# sourceMappingURL=owa.27.js.map
self.scriptsLoaded['owa.27.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.27.js'] = (new Date()).getTime();