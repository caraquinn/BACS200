self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.PersonaPhoto.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[372],{13642:function(e,t,n){"use strict";n.r(t);var r=n(984);n.d(t,"downloadPersonaPhoto",function(){return r.a})},1704:function(e,t,n){"use strict";var r,i,o;n.d(t,"c",function(){return r}),n.d(t,"b",function(){return i}),n.d(t,"a",function(){return o}),function(e){e[e.tiny=0]="tiny",e[e.extraExtraSmall=1]="extraExtraSmall",e[e.extraSmall=2]="extraSmall",e[e.small=3]="small",e[e.regular=4]="regular",e[e.large=5]="large",e[e.extraLarge=6]="extraLarge",e[e.size8=17]="size8",e[e.size10=9]="size10",e[e.size16=8]="size16",e[e.size24=10]="size24",e[e.size28=7]="size28",e[e.size32=11]="size32",e[e.size40=12]="size40",e[e.size48=13]="size48",e[e.size56=16]="size56",e[e.size72=14]="size72",e[e.size100=15]="size100"}(r||(r={})),function(e){e[e.none=0]="none",e[e.offline=1]="offline",e[e.online=2]="online",e[e.away=3]="away",e[e.dnd=4]="dnd",e[e.blocked=5]="blocked",e[e.busy=6]="busy"}(i||(i={})),function(e){e[e.lightBlue=0]="lightBlue",e[e.blue=1]="blue",e[e.darkBlue=2]="darkBlue",e[e.teal=3]="teal",e[e.lightGreen=4]="lightGreen",e[e.green=5]="green",e[e.darkGreen=6]="darkGreen",e[e.lightPink=7]="lightPink",e[e.pink=8]="pink",e[e.magenta=9]="magenta",e[e.purple=10]="purple",e[e.black=11]="black",e[e.orange=12]="orange",e[e.red=13]="red",e[e.darkRed=14]="darkRed",e[e.transparent=15]="transparent",e[e.violet=16]="violet",e[e.lightRed=17]="lightRed",e[e.gold=18]="gold",e[e.burgundy=19]="burgundy",e[e.warmGray=20]="warmGray",e[e.coolGray=21]="coolGray",e[e.gray=22]="gray",e[e.cyan=23]="cyan",e[e.rust=24]="rust"}(o||(o={}))},212:function(e,t,n){"use strict";var r=n(0),i=n(219),o=n(200),c=n(231),a=n(325),u=n.n(a),s=n(73),l=n(373),d=n.n(l),f=500;function b(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t;return Object(r.__generator)(this,function(n){return t={isUserActivity:!1},[2,d()(u()({Resource:e}),t)]})})}function p(e,t){return Object(r.__awaiter)(this,void 0,void 0,function(){return Object(r.__generator)(this,function(n){return t<1?[2,Promise.reject()]:[2,b(e).catch(function(){return Object(s.a)(f).then(function(){return p(e,t-1)})})]})})}var h,v=n(105),g=n(368),m=3,_=500;function w(e){var t=this,n=null,i=null,o=new Promise(function(e,o){return Object(r.__awaiter)(t,void 0,void 0,function(){return Object(r.__generator)(this,function(t){return n=e,i=o,[2]})})}),c={onFulfilled:n,onRejected:i,resource:e};return(null==h&&(h=new g.a(m,O,_)),h).add(c),o}function O(e){return Object(r.__awaiter)(this,void 0,void 0,function(){return Object(r.__generator)(this,function(t){return E(e.resource).then(function(t){e.onFulfilled(t)}).catch(function(t){e.onRejected(t)}),[2]})})}var j=null;function k(){return null==j&&(j=new i.Cache),j}n.d(t,"e",function(){return A}),n.d(t,"b",function(){return C}),n.d(t,"c",function(){return R}),n.d(t,"a",function(){return E}),n.d(t,"d",function(){return P});var y=1,T=12e4,x=3,z=null;function A(e){z=e}function C(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t;return Object(r.__generator)(this,function(n){switch(n.label){case 0:return null!=(t=P(U(),e))?[3,2]:[4,E(e)];case 1:t=n.sent(),n.label=2;case 2:return[2,null!=t?t.AccessToken:void 0]}})})}function R(e){var t=P(U(),e);if(t)return[t.AccessToken,void 0];if(Object(v.e)("auth-getAccessTokenQueueEnabled")){var n=function(e){return k().get(e)}(e),r=void 0;return n?r=n:(r=w(e),function(e,t){k().put(e,t)}(e,r)),[void 0,r.then(function(t){return function(e){k().del(e)}(e),t.AccessToken})]}return[void 0,E(e).then(function(e){return e.AccessToken})]}function E(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t,n,i;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return Object(v.e)("auth-getAccessTokenQueueEnabled")?[4,p(e,x)]:[3,2];case 1:return n=r.sent(),[3,4];case 2:return[4,b(e)];case 3:n=r.sent(),r.label=4;case 4:return null!=(t=n)&&0==t.TokenResultCode&&null!=t.AccessTokenExpiry&&(t.ExpiresIn&&t.ExpiresIn>0&&(t.AccessTokenExpiry=Object(c.a)(Date.now(),t.ExpiresIn).toISOString()),(i=new Date(t.AccessTokenExpiry).getTime()-Date.now()-T)>0&&U().put(e,t,i,function(e,t){E(e).catch(function(){})})),[2,t]}})})}function P(e,t){var n=e.get(t),r=void 0;n&&n.AccessTokenExpiry&&(Object(o.a)(new Date(n.AccessTokenExpiry),-y)>new Date(Date.now())&&(r=n));return r}function U(){return null==z&&(z=new i.Cache),z}},219:function(e,t,n){"use strict";function r(){var e=Object.create(null),t=0,n=0,r=0,i=!1;function o(t){r--,delete e[t]}this.put=function(t,n,i,c){if(void 0!==i&&("number"!=typeof i||isNaN(i)||i<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==c&&"function"!=typeof c)throw new Error("Cache timeout callback must be a function");var a=e[t];a?clearTimeout(a.timeout):r++;var u={value:n,expire:i+Date.now()};return isNaN(u.expire)||(u.timeout=setTimeout(function(){o(t),c&&c(t,n)}.bind(this),i)),e[t]=u,n},this.del=function(t){var n=!0,r=e[t];return r?(clearTimeout(r.timeout),!isNaN(r.expire)&&r.expire<Date.now()&&(n=!1)):n=!1,n&&o(t),n},this.clear=function(){for(var o in e)clearTimeout(e[o].timeout);r=0,e=Object.create(null),i&&(t=0,n=0)},this.get=function(o){var c=e[o];if(void 0!==c){if(isNaN(c.expire)||c.expire>=Date.now())return i&&t++,c.value;i&&n++,r--,delete e[o]}else i&&n++;return null},this.size=function(){return r},this.memsize=function(){var t,n=0;for(t in e)n++;return n},this.debug=function(e){i=e},this.hits=function(){return t},this.misses=function(){return n},this.keys=function(){return Object.keys(e)},this.exportJson=function(){var t={};for(var n in e){var r=e[n];t[n]={value:r.value,expire:r.expire||"NaN"}}return JSON.stringify(t)},this.importJson=function(t,n){var r=JSON.parse(t),i=Date.now(),o=n&&n.skipDuplicates;for(var c in r)if(r.hasOwnProperty(c)){if(o)if(e[c])continue;var a=r[c],u=a.expire-i;if(u<=0){this.del(c);continue}u=u>0?u:void 0,this.put(c,a.value,u)}return this.size()}}e.exports=new r,e.exports.Cache=r},325:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"TokenRequest:#Exchange"},e)}},373:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(199),i=n(325);t.default=function(e,t){return void 0===e||e.__type||(e=i.default(e)),r.makeServiceRequest("GetAccessTokenforResource",e,t)}},502:function(e,t,n){"use strict";n.r(t);var r=n(219),i=n(212);function o(e){Object(i.e)(new r.Cache),Object(i.b)(e.location.origin)}var c=n(0),a=n(59),u=n(264),s=n.n(u),l=n(231),d={};function f(e){return Object(c.__awaiter)(this,void 0,void 0,function(){var t,n,r;return Object(c.__generator)(this,function(i){switch(i.label){case 0:t=e.client_id+e.scope,n=encodeURIComponent(t),r={},i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,b(e,window)];case 2:return r=i.sent(),[3,5];case 3:return i.sent(),r.TokenResultCode=2,[3,5];case 4:return function(e,t){var n=t.document.getElementById(e);null!=n&&(n.removeEventListener("load",d[e]),t.document.body.removeChild(n),delete d[e])}(n,window),[7];case 5:return[2,r]}})})}function b(e,t){return Object(c.__awaiter)(this,void 0,void 0,function(){var n,r,i;return Object(c.__generator)(this,function(o){return n=encodeURIComponent(e.client_id+e.scope),r=function(e){var t={response_type:"token",prompt:"none",redirect_uri:e.redirect_uri,scope:e.scope,client_id:e.client_id};return e.authorization_uri+"?"+a.stringify(t)}(e),t.document.getElementById(n)?[2,{TokenResultCode:2}]:((i=t.document.createElement("iframe")).src=r.toString(),i.style.display="none",i.id=n,t.document.body.appendChild(i),[2,new Promise(function(e,r){d[n]=function(n){var o={};try{i.contentWindow&&i.contentWindow.location.origin==t.location.origin&&(o=function(e){var t=a.parse(e),n={};t.access_token?(n.AccessToken=t.access_token,n.AccessTokenExpiry=Object(l.a)(Date.now(),parseInt(t.expires_in)).toISOString(),n.TokenResultCode=0):"login_required"==t.error||"interaction_required"==t.error||"consent_required"==t.error?n.TokenResultCode=3:n.TokenResultCode=2;return n}(i.contentWindow.location.hash.substring(1)))}catch(e){o.TokenResultCode=2,r(o)}e(o)},i.addEventListener("load",d[n],!1)})])})})}var p=null;function h(e){return Object(c.__awaiter)(this,void 0,void 0,function(){var t,n,r,i;return Object(c.__generator)(this,function(o){switch(o.label){case 0:return t={scope:e,client_id:"",authorization_uri:"",redirect_uri:""},n=void 0,[4,s()()];case 1:return 0!=(r=o.sent()).ResultCode||null==r.ImplicitGrantAuthorizationUrl||""==r.ImplicitGrantAuthorizationUrl?[2,n]:(i=a.parse(r.ImplicitGrantAuthorizationUrl.split("?")[1]||"")).client_id&&i.redirect_uri?(t.client_id=i.client_id,t.authorization_uri=r.ImplicitGrantAuthorizationUrl.split("?")[0],t.redirect_uri=i.redirect_uri,[4,v(t)]):[3,3];case 2:n=o.sent(),o.label=3;case 3:return[2,n]}})})}function v(e){return Object(c.__awaiter)(this,void 0,void 0,function(){var t,n;return Object(c.__generator)(this,function(r){switch(r.label){case 0:return t=e.client_id+e.scope,null!=(n=Object(i.d)(g(),t))?[3,2]:[4,f(e)];case 1:n=r.sent(),function(e,t){if(t&&0==t.TokenResultCode&&t.AccessTokenExpiry){var n=new Date(t.AccessTokenExpiry).getTime()-Date.now();n>0&&g().put(e,t,n)}}(t,n),r.label=2;case 2:return[2,0==n.TokenResultCode?n.AccessToken:void 0]}})})}function g(){return null==p&&(p=new r.Cache),p}var m=n(204),_=n(377);var w=!1;function O(e){w||(!function(e){var t=Object(_.a)("/owa",e);Object(m.initializeServiceRequest)({baseUrl:t})}(e),w=!0)}function j(e,t,n,r){n?e.acquireTokenPopup(t,null,n,r):e.acquireToken(t,r)}var k=n(22),y=new k.c(function(){return Promise.all([n.e(520),n.e(108)]).then(n.bind(null,14083))}),T=new k.a(y,function(e){return e.createAdalAuthenticationContext});var x=function(e,t,n,r){return function(i,o){i||!o?r(i,null):(e.getCachedUser(),j(e,t,n,r))}},z="adalIdTokenFrame";function A(e,t,n,r){e.config.displayCall=function(i){!function(e){if(-1==e.indexOf("?"))throw new Error("Invalid Url in Adal Auth Context Display Call")}(i),window.detectUserCachedCallback=x(e,t,n,r),function(e,t){e._addAdalFrame(z).src="about:blank",e._loadFrame(t+"&prompt=none",z)}(e,i)},e.login()}function C(e,t,n,r,i){return Object(c.__awaiter)(this,void 0,void 0,function(){var o;return Object(c.__generator)(this,function(c){switch(c.label){case 0:return"https://login.microsoftonline.com/",[4,T.importAndExecute("https://login.microsoftonline.com/",e,t)];case 1:return o=c.sent(),o.getCachedUser()?j(o,n,r,i):A(o,n,r,i),[2]}})})}n.d(t,"registerTokenProvider",function(){return o}),n.d(t,"getAccessTokenforResource",function(){return i.b}),n.d(t,"getAccessTokenforResourceAsLazy",function(){return i.c}),n.d(t,"getDelegationToken",function(){return v}),n.d(t,"getDelegationTokenForOwa",function(){return h}),n.d(t,"bootstrap",function(){return O}),n.d(t,"getAccessTokenOnBehalfOfResource",function(){return C})},800:function(e,t,n){"use strict";n.d(t,"a",function(){return p}),n.d(t,"b",function(){return h});var r=n(921),i=n(1704),o=n(218),c=n(105),a=n(204),u=n(276),s="email",l="personId",d="UA",f="size",b="/service.svc/s/GetPersonaPhoto";function p(e,t,n,i){if(Object(u.a)()&&Object(c.e)("rp-imageApiConsumer"))return Object(r.a)(e,n);var o=Object(a.getConfig)().baseUrl,p="";return e&&(p=v(p,s,e&&e.toLowerCase())),t&&(p=v(p,l,t)),p=v(p,d,"0"),p=v(p,f,i?"HR96x96":"HR64x64"),""+o+b+"?"+p}function h(e,t,n){return Object(u.a)()&&Object(c.e)("rp-imageApiConsumer")?Object(r.a)(e,t):"https://cid-"+e+".users.storage.live.com/users/0x"+e+"/myprofile/expressionprofile/profilephoto:"+function(e){switch(e){case i.c.tiny:case i.c.extraExtraSmall:case i.c.extraSmall:case i.c.small:case i.c.regular:case i.c.large:case i.c.size10:case i.c.size8:case i.c.size16:case i.c.size24:case i.c.size28:case i.c.size32:return"UserTileStatic,UserTileSmall";case i.c.extraLarge:case i.c.size40:case i.c.size48:case i.c.size56:case i.c.size72:case i.c.size100:return"UserTileMedium,UserTileStatic,UserTileSmall";default:return Object(o.a)(e)}}(n)+"/MeControlMediumUserTile?ck=1&ex=24&fofoff=1"}function v(e,t,n){n&&(n=encodeURIComponent(n));var r=t+"="+n;return e&&(r=e+"&"+r),r}},921:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(4),i="https://substrate.office.com/profile/v1.0/{0}/{1}/image/$value";function o(e,t){var n=e.indexOf("@")>-1,o="GroupMailbox"==t?"groups":"users";return Object(r.b)(i,o,n?e:"cid:"+e)}},984:function(e,t,n){"use strict";var r=n(0),i=n(4),o=n(873),c=n(43),a=Object(c.action)("setIsPendingFetch")(function(e,t){e.personaBlob.isPendingFetch=t}),u=n(921),s=n(800),l=n(228),d=n(105),f=n(276),b=n(502),p=n(25);n.d(t,"a",function(){return O});var h="GetProfileImageTime",v="GetPersonaTime",g="GetProfileImageNoPhoto",m="GetPersonaResponseNoPhoto",_="https://outlook.office.com/M365.Access",w={};function O(e,t){return Object(r.__awaiter)(this,void 0,void 0,function(){var n,o=this;return Object(r.__generator)(this,function(c){switch(c.label){case 0:return n=e.personaBlob,!t&&(n.isPendingFetch||n.hasFetchFailed||n.blobUrl&&w[n.blobUrl]||Object(i.g)(e.emailAddress)&&Object(i.g)(e.personaId))?[2]:[4,new Promise(function(n,i){return Object(r.__awaiter)(o,void 0,void 0,function(){var o,c,u;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return Object(f.a)()&&Object(d.e)("rp-imageApiConsumer")?[4,j(e,t)]:[3,2];case 1:return c=r.sent(),[3,3];case 2:c=function(e,t){var n=Object(s.a)(e.emailAddress,e.personaId),r=new XMLHttpRequest;r.open("GET",n),r.responseType="blob",t&&r.setRequestHeader("Cache-Control","no-cache");return r}(e,t),r.label=3;case 3:if(o=c){a(e,!0),b=Object(f.a)()&&Object(d.e)("rp-imageApiConsumer")?h:v,u=new l.b(b),o.onreadystatechange=function(){4===o.readyState&&(k(e,o),u.end(),u=null,n())};try{o.send()}catch(t){a(e,!1),p.d.warn("Error in getPersonaPhoto "+t),i(t)}}else i("request is null");return[2]}var b})})})];case 1:return c.sent(),[2]}})})}function j(e,t){return Object(r.__awaiter)(this,void 0,void 0,function(){var n,i,c,a,s,l,d,f;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return[4,Object(b.getDelegationTokenForOwa)(_)];case 1:return(n=r.sent())?(i=Object(u.a)(e.emailAddress,e.mailboxType),(c=new XMLHttpRequest).open("GET",i),c.responseType="blob",t&&c.setRequestHeader("Cache-Control","no-cache"),c.setRequestHeader("Content-Type","image/gif"),c.setRequestHeader("Authorization","Bearer "+n),c.setRequestHeader("X-AnchorMailbox",e.emailAddress),[2,c]):(a=e.name,s=e.emailAddress,l=e.personaId,d=e.size,f=e.mailboxType,o.a.add({name:a,emailAddress:s,personaId:l,size:d,mailboxType:f}),[2,null])}})})}var k=Object(c.action)("processGetPhotoResponse")(function(e,t){if(a(e,!1),200===t.status){var n=t.response,r=t.getResponseHeader("Content-Type");if(r&&0==r.toLowerCase().indexOf("image")&&n instanceof Blob){if(n.size>100)return e.personaBlob.blobUrl=URL.createObjectURL(n),w[e.personaBlob.blobUrl]=!0,void(e.personaBlob.hasFetchFailed=!1);i=Object(f.a)()&&Object(d.e)("rp-imageApiConsumer")?g:m,Object(l.p)(i)}}var i;e.personaBlob.hasFetchFailed=!0})}},0,[520,108,23,119]]);
//# sourceMappingURL=owa.PersonaPhoto.js.map
self.scriptsLoaded['owa.PersonaPhoto.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.PersonaPhoto.js'] = (new Date()).getTime();